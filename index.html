<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        #chat{
            height: 500px;
        }

        #content{
            display: none;
        }

        #chatWrap{
            float: left;
            border: 1px solid dodgerblue;
        }
    </style>
</head>
<body>

<div id="username">
    <p id="nickError"></p>
    <p>Enter username:</p>
    <form action="" id="setNickname">
        <input type="text" id="nickname">
        <input type="submit">
    </form>
</div>


<div id="content">
    <div id="chatWrap">
        <div id="chat"></div>
        <form id="send-message">
            <input type="text" id="message"/>
            <input type="submit"/>
            <p id="valid"></p>
        </form>
    </div>
    <div id="users"></div>
</div>

<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    jQuery(function ($) {
        var socket = io.connect();

        var $nickForm = $('#setNickname');
        var $nickname = $('#nickname');
        var $nickError = $('#nickError');

        var $messageForm = $('#send-message');
        var $messageBox = $('#message');
        var $chat = $('#chat');

        $nickForm.submit(function (e) {
            e.preventDefault();
            socket.emit('new user', $nickname.val(), function (data) {
                if (data){
                    $('#username').hide();
                    $('#content').show();
                }
            });
            $nickname.val('');
        });

        $messageForm.submit(function (e) {
            e.preventDefault();

            if ($messageBox.val() == "") {
                document.getElementById("valid").innerHTML = "Can't be empty!";
            } else {
                document.getElementById("valid").innerHTML = "";
                socket.emit('send message', $messageBox.val());
                $messageBox.val('');
            }

        });

        socket.on('new message', function (data) {
            $chat.append(data + "<br/>")
        });
    });
</script>
</body>
</html>